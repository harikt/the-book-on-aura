<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="author" content="Hari KT, Paul M Jones" />
    <meta name="date" content="07/08/2013"/>
    <meta name="generator" content="easybook 5.0-DEV"/>

    <title>Package Organization | The complete reference for Aura</title>

    <link rel="stylesheet" href="./css/easybook.css" />

</head>

<body class="item chapter">
<div class="container">
<div class="menu">
    <div class="row">
        <h1 class="span9"><a href="./index.html">The complete reference for Aura</a></h1>
        <p class="span3">
                        <a href="./chapter-3.html"><span>&larr;</span> Previous</a>
            
                        <a href="./chapter-5.html">Next <span>&rarr;</span></a>
                    </p>
    </div>
</div>

<div class="row">
    <div class="span9">
        <h1 id="package-organization"><span>Chapter 4</span> Package Organization</h1>
        <p>In Aura, all code is grouped into packages. There is no difference between
library packages, support packages, web packages, and so on -- they are all
just "packages."</p>

<p>The package directory structure looks like this:</p>

<div class="code bash">
<pre class="bash">Vendor.Package<span class="sy0">/</span>
    cli<span class="sy0">/</span>                        <span class="co0"># command-line script invokers</span>
    composer.json               <span class="co0"># composer/packagist file</span>
    config<span class="sy0">/</span>                     <span class="co0"># package-level configs</span>
        default.php             <span class="co0"># default configs</span>
        test.php                <span class="co0"># configs for &quot;test&quot; mode</span>
    meta<span class="sy0">/</span>                       <span class="co0"># metadata for packaging scripts</span>
    LICENSE                     <span class="co0"># license file</span>
    README.md                   <span class="co0"># readme file</span>
    src<span class="sy0">/</span>                        <span class="co0"># the actual source code organized for PSR-0</span>
        Vendor<span class="sy0">/</span>
            Package<span class="sy0">/</span>
                Class.php
    tests<span class="sy0">/</span>                      <span class="co0"># test files for phpunit</span>
        Vendor<span class="sy0">/</span>
            Package<span class="sy0">/</span>
                ClassTest.php
        bootstrap.php
        phpunit.xml
    web<span class="sy0">/</span>                        <span class="co0"># public web assets</span>
        styles<span class="sy0">/</span>                 <span class="co0"># css files</span>
        images<span class="sy0">/</span>                 <span class="co0"># image files</span>
        scripts<span class="sy0">/</span>                <span class="co0"># javascript (or other script) files</span></pre>
</div>

<p>In general, your <code>src/</code> files should be organized like so:</p>

<div class="code bash">
<pre class="bash">Vendor<span class="sy0">/</span>
    Package<span class="sy0">/</span>
        Cli<span class="sy0">/</span>                    <span class="co0"># all CLI commands</span>
            CommandName<span class="sy0">/</span>        <span class="co0"># a particular CLI command and its support files</span>
                Command.php     <span class="co0"># the actual command logic</span>
                data<span class="sy0">/</span>           <span class="co0"># other data for the command</span>
        Web<span class="sy0">/</span>                    <span class="co0"># all web pages</span>
            PageName<span class="sy0">/</span>           <span class="co0"># a particular web page and its support files</span>
                Page.php        <span class="co0"># the actual page action logic</span>
                views<span class="sy0">/</span>          <span class="co0"># views for the page</span>
                layouts<span class="sy0">/</span>        <span class="co0"># layouts for the page</span>
                data<span class="sy0">/</span>           <span class="co0"># other data for the page</span>
        View<span class="sy0">/</span>
            Helper<span class="sy0">/</span>
                HelperName.php  <span class="co0"># a view helper</span></pre>
</div>

<p>You can of course place other libraries in the package if you like.</p>

<h2 id="creating-your-package">4.1 Creating your Package</h2>

<p>Let's create a package and a page controller, to greet a person</p>

<h2 id="package-structure">4.2 Package Structure</h2>

<p>First, create the package structure (just the parts we need):</p>

<div class="code bash">
<pre class="bash">$ <span class="kw2">mkdir</span> <span class="re5">-p</span> package<span class="sy0">/</span>Example.Package<span class="sy0">/</span>src<span class="sy0">/</span>Example<span class="sy0">/</span>Package<span class="sy0">/</span>Web<span class="sy0">/</span>Greet<span class="sy0">/</span>views
$ <span class="kw2">mkdir</span> package<span class="sy0">/</span>Example.Package<span class="sy0">/</span>config</pre>
</div>

<div class="code code">
<pre class="code">Note : If you are in *nix system the -p command works. If you are in 
windows, you may want to create each directory seprately.</pre>
</div>

<h2 id="page-controller-and-view">4.3 Page Controller and View</h2>

<p>Let us create our controller. Open your favourite editor and save the code
below</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="kw2">namespace</span> Example\Package\Web\Quick<span class="sy0">;</span>
<span class="kw2">use</span> Aura\Framework\Web\Controller\AbstractPage<span class="sy0">;</span>
<span class="kw2">class</span> Page <span class="kw2">extends</span> AbstractPage
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">function</span> actionIndex<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="sy0">-&gt;</span><span class="me1">message</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">context</span><span class="sy0">-&gt;</span><span class="me1">getQuery</span><span class="br0">&#40;</span><span class="st_h">'name'</span><span class="sy0">,</span> <span class="st_h">'guys!'</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">view</span> <span class="sy0">=</span> <span class="st_h">'index'</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>as <code>Page.php</code> in the folder <code>package/Example.Package/src/Example/Package/Web/Greet/</code></p>

<p>Next, we need to create a view for the action. Paste the below code</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">title</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">&#40;</span><span class="st_h">'Welcome to the world of Aura Framework!'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="sy1">?&gt;</span>
&lt;h1&gt;Hey good day <span class="sy1">&lt;?=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">message</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>&lt;/h1&gt;
&lt;form method=&quot;get&quot; action=&quot;<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">route</span><span class="br0">&#40;</span><span class="st_h">'example_package_greet'</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>&quot; class=&quot;form-search&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;name&quot; id=&quot;name&quot; class=&quot;input-medium search-query&quot; placeholder=&quot;Name&quot; /&gt;
    &lt;input type=&quot;submit&quot; name=&quot;greet&quot; id=&quot;greet&quot; value=&quot;Greet&quot; class=&quot;btn&quot; /&gt;
&lt;/form&gt;
&nbsp;</pre>
</div>

<p>and save it as <code>index.php</code> in <code>package/Example.Package/src/Example/Package/Web/Greet/views</code>
folder.</p>

<p>At this point your package directory should look like this:</p>

<div class="code bash">
<pre class="bash">Example.Package<span class="sy0">/</span>
    src<span class="sy0">/</span>
        Example<span class="sy0">/</span>
            Package<span class="sy0">/</span>
                Web<span class="sy0">/</span>
                    Greet<span class="sy0">/</span>
                        Page.php
                        views<span class="sy0">/</span>
                            index.php</pre>
</div>

<h2 id="configuration">4.4 Configuration</h2>

<p>We have not added any files to the autoloader, and have not specified 
the routes. Its time to add it in the configuration.</p>

<p>Open the editor and paste the below contents</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co4">/** Example Package configs */</span>
&nbsp;
<span class="co1">// add the package to the autoloader</span>
<span class="re0">$loader</span><span class="sy0">-&gt;</span><span class="me1">add</span><span class="br0">&#40;</span><span class="st_h">'Example\Package\\'</span><span class="sy0">,</span> <span class="kw3">dirname</span><span class="br0">&#40;</span>__DIR__<span class="br0">&#41;</span> <span class="sy0">.</span> <span class="kw4">DIRECTORY_SEPARATOR</span> <span class="sy0">.</span> <span class="st_h">'src'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// add a route to the page and action</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'router_map'</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">add</span><span class="br0">&#40;</span><span class="st_h">'example_package_greet'</span><span class="sy0">,</span> <span class="st_h">'/greet'</span><span class="sy0">,</span> <span class="br0">&#91;</span>
    <span class="st_h">'values'</span> <span class="sy0">=&gt;</span> <span class="br0">&#91;</span>
        <span class="st_h">'controller'</span> <span class="sy0">=&gt;</span> <span class="st_h">'greet'</span><span class="sy0">,</span>
        <span class="st_h">'action'</span> <span class="sy0">=&gt;</span> <span class="st_h">'index'</span><span class="sy0">,</span>
    <span class="br0">&#93;</span><span class="sy0">,</span>
<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// map the 'greet' controller value to a page controller class</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">params</span><span class="br0">&#91;</span><span class="st_h">'Aura\Framework\Web\Controller\Factory'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'map'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'greet'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st_h">'Example\Package\Web\Greet\Page'</span><span class="sy0">;</span></pre>
</div>

<p>Save the files as <code>default.php</code> in <code>Example.Package/config</code> folder.</p>

<h2 id="loading-your-package">4.5 Loading your package</h2>

<p>For the framework to load your package and the configuration files, 
you need to add your package in the <code>{$system}/config/_packages</code> file.</p>

<p>This is because some packages, depend on another package. So the configuration
needs to be loaded first. The packages are loaded in the order it is 
written in <code>{$system}/config/_packages</code> file.</p>

<h2 id="try-it-out">4.6 Try it out</h2>

<p>It is time to see what we did so far.
Let us use the PHP's built in capability of running it as server from cli</p>

<div class="code code">
<pre class="code">$ php -S localhost:8000 web/index.php</pre>
</div>

<p>Browse <code>http://localhost:8000/greet</code> URL and see <code>Hey good day</code> and if you 
insert <code>Bob</code> in the input box and submit, you will see <code>Hey good day Bob</code></p>

    </div>

    <div class="span3">
        <div class="item local_toc">
            <h3>Table of contents</h3>

            <ul class="unstyled">
                                                <li class="level-1">
                        <span></span>
                        <a class="internal" href="./chapter-4.html#package-organization">Package Organization</a>
                    </li>
                                    <li class="level-2">
                        <span>4.1</span>
                        <a class="internal" href="./chapter-4.html#creating-your-package">Creating your Package</a>
                    </li>
                                    <li class="level-2">
                        <span>4.2</span>
                        <a class="internal" href="./chapter-4.html#package-structure">Package Structure</a>
                    </li>
                                    <li class="level-2">
                        <span>4.3</span>
                        <a class="internal" href="./chapter-4.html#page-controller-and-view">Page Controller and View</a>
                    </li>
                                    <li class="level-2">
                        <span>4.4</span>
                        <a class="internal" href="./chapter-4.html#configuration">Configuration</a>
                    </li>
                                    <li class="level-2">
                        <span>4.5</span>
                        <a class="internal" href="./chapter-4.html#loading-your-package">Loading your package</a>
                    </li>
                                    <li class="level-2">
                        <span>4.6</span>
                        <a class="internal" href="./chapter-4.html#try-it-out">Try it out</a>
                    </li>
                                        </ul>
        </div>
    </div>
</div>
</div>
</body>
</html>