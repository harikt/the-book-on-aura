<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="author" content="Hari KT, Paul M Jones" />
    <meta name="date" content="07/08/2013"/>
    <meta name="generator" content="easybook 5.0-DEV"/>

    <title>Generic Factory | The complete reference for Aura</title>

    <link rel="stylesheet" href="./css/easybook.css" />

</head>

<body class="item chapter">
<div class="container">
<div class="menu">
    <div class="row">
        <h1 class="span9"><a href="./index.html">The complete reference for Aura</a></h1>
        <p class="span3">
                        <a href="./chapter-8.html"><span>&larr;</span> Previous</a>
            
                        <a href="./chapter-10.html">Next <span>&rarr;</span></a>
                    </p>
    </div>
</div>

<div class="row">
    <div class="span9">
        <h1 id="generic-factory"><span>Chapter 9</span> Generic Factory</h1>
        <p>If you are not familiar with dependency injection and how the dependency 
injection container works, please read Dependency injection chapter on 
Aura.Di.</p>

<p>In-order to make use of the dependency injection, when creating models, 
forms etc, it will be good to have a generic factory. The aura framework 
doesn't provide one.</p>

<p>But let us create it</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="kw2">namespace</span> Example\Package<span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> GenericFactory
<span class="br0">&#123;</span>
    <span class="kw2">protected</span> <span class="re0">$map</span><span class="sy0">;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span><span class="re0">$map</span> <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span> 
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">map</span> <span class="sy0">=</span> <span class="re0">$map</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> newInstance<span class="br0">&#40;</span><span class="re0">$name</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span> <span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">map</span><span class="br0">&#91;</span><span class="re0">$name</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> \Exception<span class="br0">&#40;</span><span class="st0">&quot;<span class="es4">$name</span> not mapped&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
        <span class="re0">$factory</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">map</span><span class="br0">&#91;</span><span class="re0">$name</span><span class="br0">&#93;</span><span class="sy0">;</span>
        <span class="re0">$model</span> <span class="sy0">=</span> <span class="re0">$factory</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">return</span> <span class="re0">$model</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;</pre>
</div>

<p>Save the above contents as <code>GenericFactory.php</code> in 
<code>package/Example.Package/src/Example/Package</code> folder.</p>

<h2 id="extending-the-controller">9.1 Extending the controller</h2>

<p>We can set <code>GenericFactory</code> as a setter injection on the controller.</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="kw2">namespace</span> Example\Package\Web<span class="sy0">;</span>
&nbsp;
<span class="kw2">use</span> Aura\Framework\Web\Controller\AbstractPage<span class="sy0">;</span>
<span class="kw2">abstract</span> <span class="kw2">class</span> PageController <span class="kw2">extends</span> AbstractPage
<span class="br0">&#123;</span>        
    <span class="kw2">protected</span> <span class="re0">$factory</span><span class="sy0">;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> setFactory<span class="br0">&#40;</span>GenericFactory <span class="re0">$factory</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">factory</span> <span class="sy0">=</span> <span class="re0">$factory</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw2">public</span> <span class="kw2">function</span> getFactory<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">factory</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Save the above contents as <code>PageController.php</code> in 
<code>package/Example.Package/src/Example/Package/Web</code> folder.</p>

<p>Let us modify our example to extend our <code>PageController</code>.
The <code>package/Example.Package/src/Example/Package/Web/Greet/Page.php</code> will 
look as below</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="kw2">namespace</span> Example\Package\Web\Quick<span class="sy0">;</span>
&nbsp;
<span class="kw2">use</span> Example\Package\Web\PageController<span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> Page <span class="kw2">extends</span> PageController
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">function</span> actionIndex<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="sy0">-&gt;</span><span class="me1">message</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">context</span><span class="sy0">-&gt;</span><span class="me1">getQuery</span><span class="br0">&#40;</span><span class="st_h">'name'</span><span class="sy0">,</span> <span class="st_h">'guys!'</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">view</span> <span class="sy0">=</span> <span class="st_h">'index'</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<h2 id="configuration-3">9.2 Configuration</h2>

<p>So far we have not configured to set the <code>GenericFactory</code> object to 
<code>PageController</code>. Let us add in our <code>package/Example.Package/config/default.php</code>
the below contents.</p>

<div class="code php">
<pre class="php"><span class="co1">// the generic factory service</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">set</span><span class="br0">&#40;</span><span class="st_h">'generic_factory'</span><span class="sy0">,</span> <span class="kw2">function</span> <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw2">use</span> <span class="br0">&#40;</span><span class="re0">$di</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">newInstance</span><span class="br0">&#40;</span><span class="st_h">'Example\Package\GenericFactory'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">setter</span><span class="br0">&#91;</span><span class="st_h">'Example\Package\Web\PageController'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'setFactory'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">lazyGet</span><span class="br0">&#40;</span><span class="st_h">'generic_factory'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Inorder to create the objects, you need to assign to the map.</p>

<div class="code php">
<pre class="php"><span class="co1">// default params for the model factory</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">params</span><span class="br0">&#91;</span><span class="st_h">'Example\Package\GenericFactory'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'map'</span><span class="br0">&#93;</span>
    <span class="br0">&#91;</span><span class="st_h">'model.user'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">newFactory</span><span class="br0">&#40;</span><span class="st_h">'Example\Package\Model\User'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">params</span><span class="br0">&#91;</span><span class="st_h">'Example\Package\GenericFactory'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'map'</span><span class="br0">&#93;</span>
    <span class="br0">&#91;</span><span class="st_h">'model.post'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">newFactory</span><span class="br0">&#40;</span><span class="st_h">'Example\Package\Model\Post'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">params</span><span class="br0">&#91;</span><span class="st_h">'Example\Package\GenericFactory'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'map'</span><span class="br0">&#93;</span>
    <span class="br0">&#91;</span><span class="st_h">'form.user.login'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$di</span><span class="sy0">-&gt;</span><span class="me1">newFactory</span><span class="br0">&#40;</span><span class="st_h">'Example\Package\Form\Login'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;</pre>
</div>

<p>And now from the controller you can create objects like</p>

<div class="code php">
<pre class="php"><span class="re0">$user</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getFactory</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">newInstance</span><span class="br0">&#40;</span><span class="st_h">'model.user'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$form</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getFactory</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">newInstance</span><span class="br0">&#40;</span><span class="st_h">'form.user.login'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

    </div>

    <div class="span3">
        <div class="item local_toc">
            <h3>Table of contents</h3>

            <ul class="unstyled">
                                                <li class="level-1">
                        <span></span>
                        <a class="internal" href="./chapter-9.html#generic-factory">Generic Factory</a>
                    </li>
                                    <li class="level-2">
                        <span>9.1</span>
                        <a class="internal" href="./chapter-9.html#extending-the-controller">Extending the controller</a>
                    </li>
                                    <li class="level-2">
                        <span>9.2</span>
                        <a class="internal" href="./chapter-9.html#configuration-3">Configuration</a>
                    </li>
                                        </ul>
        </div>
    </div>
</div>
</div>
</body>
</html>